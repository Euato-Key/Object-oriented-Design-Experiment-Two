# 物联网设备知识图谱交互管理平台 - 实验二报告

## 06. 数据库设计

### 1. 数据库概览
本平台采用混合数据库架构，以满足不同类型数据的存储需求：
- **MySQL (关系型数据库)**: 存储核心业务数据，如设备档案、用户信息、权限配置、告警记录等。
- **Neo4j (图数据库)**: 存储设备知识图谱，包括设备实体、空间位置、业务关系等，支持高效的关联查询。
- **InfluxDB (时序数据库)**: 存储设备上报的高频时序数据（Telemetry），如温度、湿度、CPU使用率等。

### 2. 概念模型设计 (ER图)
以下ER图展示了关系型数据库中的核心实体及其关系。

![ER图](./diagrams/er_diagram.mmd)

### 3. 数据字典 (MySQL)

#### 3.1 设备管理模块

**3.1.1 设备表 (Device)**
存储设备的基础信息。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| device_id | VARCHAR | 64 | Y | 主键，设备唯一标识 |
| name | VARCHAR | 128 | Y | 设备名称 |
| type_id | VARCHAR | 32 | Y | 外键，关联设备类型表 |
| group_id | VARCHAR | 32 | N | 外键，关联设备分组表 |
| status | VARCHAR | 20 | Y | 在线状态 (ONLINE, OFFLINE) |
| ip_address | VARCHAR | 45 | N | 设备IP地址 |
| created_at | DATETIME | - | Y | 注册时间 |

**3.1.2 设备类型表 (DeviceType)**
定义设备的种类和协议。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| type_id | VARCHAR | 32 | Y | 主键 |
| name | VARCHAR | 50 | Y | 类型名称 (如: 智能电表) |
| protocol | VARCHAR | 20 | Y | 通信协议 (MQTT, CoAP) |
| description | VARCHAR | 255 | N | 描述 |

**3.1.3 设备分组表 (DeviceGroup)**
用于设备的逻辑分组管理。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| group_id | VARCHAR | 32 | Y | 主键 |
| name | VARCHAR | 50 | Y | 分组名称 |
| parent_id | VARCHAR | 32 | N | 父分组ID (支持树形结构) |

**3.1.4 设备配置历史表 (DeviceConfig)**
记录设备配置的版本变更。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| config_id | VARCHAR | 64 | Y | 主键 |
| device_id | VARCHAR | 64 | Y | 外键，关联设备表 |
| version | VARCHAR | 20 | Y | 配置版本号 |
| content | JSON | - | Y | 配置内容 |
| created_at | DATETIME | - | Y | 创建时间 |

#### 3.2 告警与运维模块

**3.2.1 告警表 (Alert)**
存储设备产生的告警事件。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| alert_id | VARCHAR | 64 | Y | 主键 |
| device_id | VARCHAR | 64 | Y | 外键，关联设备表 |
| rule_id | VARCHAR | 64 | Y | 外键，关联告警规则表 |
| severity | VARCHAR | 20 | Y | 严重等级 (INFO, WARNING, CRITICAL) |
| status | VARCHAR | 20 | Y | 处理状态 (PENDING, PROCESSED) |
| details | TEXT | - | N | 告警详情JSON |
| created_at | DATETIME | - | Y | 发生时间 |

**3.2.2 告警规则表 (AlertRule)**
定义告警触发条件。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| rule_id | VARCHAR | 64 | Y | 主键 |
| name | VARCHAR | 100 | Y | 规则名称 |
| metric | VARCHAR | 50 | Y | 监控指标 (如: cpu_usage) |
| condition | VARCHAR | 20 | Y | 条件操作符 (>, <, =) |
| threshold | DOUBLE | - | Y | 阈值 |
| severity | VARCHAR | 20 | Y | 默认严重等级 |

**3.2.3 操作日志表 (OperationLog)**
审计用户的关键操作。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| log_id | VARCHAR | 64 | Y | 主键 |
| user_id | VARCHAR | 64 | Y | 外键，操作用户 |
| device_id | VARCHAR | 64 | N | 外键，目标设备 |
| action | VARCHAR | 50 | Y | 动作 (如: REBOOT, UPDATE_CONFIG) |
| ip_address | VARCHAR | 45 | Y | 操作源IP |
| timestamp | DATETIME | - | Y | 操作时间 |

#### 3.3 用户与权限模块

**3.3.1 用户表 (User)**
存储系统用户信息。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| user_id | VARCHAR | 64 | Y | 主键 |
| username | VARCHAR | 50 | Y | 用户名 |
| password_hash | VARCHAR | 128 | Y | 密码哈希 |
| role_id | VARCHAR | 32 | Y | 外键，关联角色表 |
| status | TINYINT | 1 | Y | 账号状态 (1:正常, 0:禁用) |

**3.3.2 角色表 (Role)**
定义系统角色。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| role_id | VARCHAR | 32 | Y | 主键 |
| name | VARCHAR | 50 | Y | 角色名称 (如: 管理员, 运维人员) |
| description | VARCHAR | 255 | N | 描述 |

**3.3.3 权限表 (Permission)**
定义细粒度权限。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| perm_id | VARCHAR | 32 | Y | 主键 |
| code | VARCHAR | 50 | Y | 权限代码 (如: device:view) |
| description | VARCHAR | 100 | Y | 权限描述 |

**3.3.4 角色权限关联表 (RolePermission)**
角色与权限的多对多关系。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| id | BIGINT | - | Y | 自增主键 |
| role_id | VARCHAR | 32 | Y | 外键 |
| perm_id | VARCHAR | 32 | Y | 外键 |

#### 3.4 部署包表 (DeploymentPackage)
存储可部署的系统组件或固件包信息。

| 字段名 | 类型 | 长度 | 必填 | 说明 |
| :--- | :--- | :--- | :--- | :--- |
| package_id | VARCHAR | 64 | Y | 主键 |
| name | VARCHAR | 100 | Y | 包名称 |
| version | VARCHAR | 20 | Y | 版本号 |
| type | VARCHAR | 20 | Y | 包类型 (FIRMWARE, SOFTWARE) |
| url | VARCHAR | 255 | Y | 存储路径/下载URL |
| checksum | VARCHAR | 64 | Y | 文件校验和 |

### 4. 图数据库模型 (Neo4j)
图数据库用于构建设备知识图谱。

#### 4.1 节点标签 (Labels)
- `:Device`: 设备实体
- `:Location`: 物理位置（如：机房、楼层）
- `:System`: 业务系统
- `:Person`: 负责人
- `:Alert`: 告警事件

#### 4.2 关系类型 (Relationships)
- `(:Device)-[:LOCATED_IN]->(:Location)`: 设备位于某地
- `(:Device)-[:CONNECTS_TO]->(:Device)`: 设备间的网络连接
- `(:Device)-[:DEPENDS_ON]->(:Device)`: 依赖关系
- `(:Person)-[:MANAGES]->(:Device)`: 负责人管理设备
- `(:Device)-[:HAS_ALERT]->(:Alert)`: 设备产生告警

---
*下一部分：用户界面设计*
