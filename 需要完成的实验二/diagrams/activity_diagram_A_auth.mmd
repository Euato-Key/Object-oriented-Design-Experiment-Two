stateDiagram-v2
    [*] --> 接收连接请求
    接收连接请求 --> 验证请求格式
    验证请求格式 --> 格式错误: 失败
    验证请求格式 --> 检查设备注册
    检查设备注册 --> 设备未注册: 失败
    检查设备注册 --> 验证凭证签名
    验证凭证签名 --> 签名无效: 失败
    验证凭证签名 --> 生成访问令牌
    生成访问令牌 --> 更新设备状态
    更新设备状态 --> 返回成功响应
    返回成功响应 --> [*]
    
    格式错误 --> 记录安全日志
    设备未注册 --> 记录安全日志
    签名无效 --> 记录安全日志
    记录安全日志 --> 返回错误响应
    返回错误响应 --> [*]
